<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>RSpec::Core::Formatters::HtmlSnippetExtractor</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../../css/github.css" type="text/css" media="screen" />
<script src="../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>


    <meta property="og:title" value="RSpec::Core::Formatters::HtmlSnippetExtractor">

  
    
    <meta name="description" content="@api private  Extracts code snippets by looking at the backtrace of the passed error and applies synax highlighting and line numbers using html.">
    <meta property="og:description" content="@api private  Extracts code snippets by looking at the backtrace of the passed error and applies synax highlighting and line numbers using html.">
  

    <meta name="keywords" content="RSpec::Core::Formatters::HtmlSnippetExtractor class">
  
    <meta name="keywords" content="snippet, snippet_for, lines_around, post_process">
  
</head>

<body>
    <div class="banner">
        
        <h1>
            <span class="type">Class</span>
            RSpec::Core::Formatters::HtmlSnippetExtractor
            
                <span class="parent">&lt;
                    
                    <a href="../../../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../../files/vendor/bundle/ruby/2_6_0/gems/rspec-core-3_8_0/lib/rspec/core/formatters/html_snippet_extractor_rb.html">vendor/bundle/ruby/2.6.0/gems/rspec-core-3.8.0/lib/rspec/core/formatters/html_snippet_extractor.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>@api private</p>

<p>Extracts code snippets by looking at the backtrace of the passed error and applies synax highlighting and line numbers using html.</p>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">MODULE</span>
          <a href="HtmlSnippetExtractor/CoderayConverter.html">RSpec::Core::Formatters::HtmlSnippetExtractor::CoderayConverter</a>
        </li>
      
        <li>
          <span class="type">MODULE</span>
          <a href="HtmlSnippetExtractor/NullConverter.html">RSpec::Core::Formatters::HtmlSnippetExtractor::NullConverter</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-lines_around">lines_around</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-post_process">post_process</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-snippet">snippet</a>,
              </li>
            
              
              <li>
                <a href="#method-i-snippet_for">snippet_for</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
    
    
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-lines_around">
            
              <b>lines_around</b>(file, line)
            
            <a href="../../../../classes/RSpec/Core/Formatters/HtmlSnippetExtractor.html#method-i-lines_around" name="method-i-lines_around" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>@api private</p>

<p>Extract lines of code centered around a particular line within a source file.</p>

<p>@param file [String] filename @param line [Fixnum] line number @return [String] lines around the target line within the file (2 above</p>

<pre><code>and 1 below).
</code></pre>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-lines_around_source')" id="l_method-i-lines_around_source">show</a>
                
              </p>
              <div id="method-i-lines_around_source" class="dyn-source">
                <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.6.0/gems/rspec-core-3.8.0/lib/rspec/core/formatters/html_snippet_extractor.rb, line 84</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lines_around</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">line</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">file</span>)
    <span class="ruby-identifier">lines</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">file</span>).<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>)
    <span class="ruby-identifier">min</span> = [<span class="ruby-value">0</span>, <span class="ruby-identifier">line</span> <span class="ruby-operator">-</span> <span class="ruby-value">3</span>].<span class="ruby-identifier">max</span>
    <span class="ruby-identifier">max</span> = [<span class="ruby-identifier">line</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>].<span class="ruby-identifier">min</span>
    <span class="ruby-identifier">selected_lines</span> = []
    <span class="ruby-identifier">selected_lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
    <span class="ruby-identifier">lines</span>[<span class="ruby-identifier">min</span><span class="ruby-operator">..</span><span class="ruby-identifier">max</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-node">&quot;# Couldn&#39;t get snippet for #{file}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">SecurityError</span>
  <span class="ruby-node">&quot;# Couldn&#39;t get snippet for #{file}&quot;</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-post_process">
            
              <b>post_process</b>(highlighted, offending_line)
            
            <a href="../../../../classes/RSpec/Core/Formatters/HtmlSnippetExtractor.html#method-i-post_process" name="method-i-post_process" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>@api private</p>

<p>Adds line numbers to all lines and highlights the line where the failure occurred using html `span` tags.</p>

<p>@param highlighted [String] syntax-highlighted snippet surrounding the</p>

<pre><code>offending line of code
</code></pre>

<p>@param offending_line [Fixnum] line where failure occured @return [String] completed snippet</p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-post_process_source')" id="l_method-i-post_process_source">show</a>
                
              </p>
              <div id="method-i-post_process_source" class="dyn-source">
                <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.6.0/gems/rspec-core-3.8.0/lib/rspec/core/formatters/html_snippet_extractor.rb, line 108</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">post_process</span>(<span class="ruby-identifier">highlighted</span>, <span class="ruby-identifier">offending_line</span>)
  <span class="ruby-identifier">new_lines</span> = []
  <span class="ruby-identifier">highlighted</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>).<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">new_line</span> = <span class="ruby-node">&quot;&lt;span class=\&quot;linenum\&quot;&gt;#{offending_line + i - 2}&lt;/span&gt;#{line}&quot;</span>
    <span class="ruby-identifier">new_line</span> = <span class="ruby-node">&quot;&lt;span class=\&quot;offending\&quot;&gt;#{new_line}&lt;/span&gt;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
    <span class="ruby-identifier">new_lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_line</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">new_lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-snippet">
            
              <b>snippet</b>(backtrace)
            
            <a href="../../../../classes/RSpec/Core/Formatters/HtmlSnippetExtractor.html#method-i-snippet" name="method-i-snippet" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>@api private</p>

<p>Extract lines of code corresponding to  a backtrace.</p>

<p>@param backtrace [String] the backtrace from a test failure @return [String] highlighted code snippet indicating where the test</p>

<pre><code>failure occured
</code></pre>

<p>@see <a href="HtmlSnippetExtractor.html#method-i-post_process"><code>post_process</code></a></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-snippet_source')" id="l_method-i-snippet_source">show</a>
                
              </p>
              <div id="method-i-snippet_source" class="dyn-source">
                <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.6.0/gems/rspec-core-3.8.0/lib/rspec/core/formatters/html_snippet_extractor.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">snippet</span>(<span class="ruby-identifier">backtrace</span>)
  <span class="ruby-identifier">raw_code</span>, <span class="ruby-identifier">line</span> = <span class="ruby-identifier">snippet_for</span>(<span class="ruby-identifier">backtrace</span>[<span class="ruby-value">0</span>])
  <span class="ruby-identifier">highlighted</span> = <span class="ruby-identifier">@@converter</span>.<span class="ruby-identifier">convert</span>(<span class="ruby-identifier">raw_code</span>)
  <span class="ruby-identifier">post_process</span>(<span class="ruby-identifier">highlighted</span>, <span class="ruby-identifier">line</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-snippet_for">
            
              <b>snippet_for</b>(error_line)
            
            <a href="../../../../classes/RSpec/Core/Formatters/HtmlSnippetExtractor.html#method-i-snippet_for" name="method-i-snippet_for" class="permalink">Link</a>
          </div>

          
            <div class="description">
              <p>@api private</p>

<p>Create a snippet from a line of code.</p>

<p>@param error_line [String] file name with line number (i.e.</p>

<pre><code>&#39;foo_spec.rb:12&#39;)
</code></pre>

<p>@return [String] lines around the target line within the file</p>

<p>@see <a href="HtmlSnippetExtractor.html#method-i-lines_around"><code>lines_around</code></a></p>
            </div>
          

          

          

          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source:
                <a href="javascript:toggleSource('method-i-snippet_for_source')" id="l_method-i-snippet_for_source">show</a>
                
              </p>
              <div id="method-i-snippet_for_source" class="dyn-source">
                <pre><span class="ruby-comment"># File vendor/bundle/ruby/2.6.0/gems/rspec-core-3.8.0/lib/rspec/core/formatters/html_snippet_extractor.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">snippet_for</span>(<span class="ruby-identifier">error_line</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">error_line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/(.*):(\d+)/</span>
    <span class="ruby-identifier">file</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">line</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span>
    [<span class="ruby-identifier">lines_around</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">line</span>), <span class="ruby-identifier">line</span>]
  <span class="ruby-keyword">else</span>
    [<span class="ruby-node">&quot;# Couldn&#39;t get snippet for #{error_line}&quot;</span>, <span class="ruby-value">1</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
      
    
  
</div>

    </div>
  </body>
</html>
